# 代码建议功能 - 使用指南

## ✅ 功能已实现

前端已完整实现智能代码建议功能！

---

## 🎯 功能特点

### 1. 自动获取建议
- 输入名称后自动获取代码建议（500ms防抖）
- 支持中文和英文
- 支持多种生成规则

### 2. 智能规则
- **中文**: 拼音首字母（如：牛奶 → nn）
- **英文**: 音节缩写（如：Milk → MK）
- **设备**: 符号代码（如：搅拌机 → []）
- **常用**: 预定义缩写（如：Coffee → C）

### 3. 用户友好
- 点击标签快速选择
- 可以手动输入自定义代码
- 实时显示建议说明

---

## 📋 使用流程

### 步骤1: 打开创建步骤类型对话框

在配方管理页面，点击"步骤类型管理" Tab，然后点击"添加步骤类型"按钮。

### 步骤2: 选择分类

```
○ 原料    ○ 设备    ○ 动作
```

- **原料** (ingredient): 茶、牛奶、糖等
- **设备** (equipment): 搅拌机、加热器等
- **动作** (action): 加热、冷却等

### 步骤3: 输入名称

```
名称: [Milk___________]
```

输入后等待500ms，系统会自动获取代码建议。

### 步骤4: 查看建议

```
推荐代码 (点击选择):

┌─────────────────────────────────────────┐
│ MK  英文音节缩写: Milk → MK (去除元音)   │
│ M   常用缩写: Milk → M                   │
│ mi  前缀: Milk → mi                      │
└─────────────────────────────────────────┘
```

### 步骤5: 选择或输入代码

**方式1**: 点击建议标签
- 点击任意建议，代码会自动填入

**方式2**: 手动输入
- 在代码输入框中输入自定义代码

### 步骤6: 保存

点击"保存"按钮，步骤类型创建完成！

---

## 🌟 示例演示

### 示例1: 创建"牛奶"步骤类型

1. **选择分类**: 原料
2. **输入名称**: 牛奶
3. **查看建议**:
   ```
   nn  拼音首字母: 牛奶 → nn
   NN  拼音首字母大写: 牛奶 → NN
   M   英文缩写: Milk → M
   ```
4. **选择代码**: 点击 `M`
5. **保存**: ✅ 创建成功

**结果**:
```json
{
  "name": "牛奶",
  "code": "M",
  "category": "ingredient"
}
```

### 示例2: 创建"Coffee"步骤类型

1. **选择分类**: 原料
2. **输入名称**: Coffee
3. **查看建议**:
   ```
   CF  英文音节缩写: Coffee → CF
   C   首字母: Coffee → C
   ```
4. **选择代码**: 点击 `CF`
5. **保存**: ✅ 创建成功

**结果**:
```json
{
  "name": "Coffee",
  "code": "CF",
  "category": "ingredient"
}
```

### 示例3: 创建"搅拌机"步骤类型

1. **选择分类**: 设备
2. **输入名称**: Blender
3. **查看建议**:
   ```
   BLND  英文音节缩写: Blender → BLND
   ```
4. **查看设备符号**:
   ```
   []  方括号 - 适用于搅拌机、榨汁机等混合设备
   ()  圆括号 - 适用于蒸煮设备
   {}  花括号 - 适用于烘焙设备
   ```
5. **选择代码**: 点击 `[]`
6. **保存**: ✅ 创建成功

**结果**:
```json
{
  "name": "Blender",
  "code": "[]",
  "category": "equipment"
}
```

---

## 🎨 UI展示

### 原料步骤类型

```
┌─────────────────────────────────────────────┐
│ 创建步骤类型                                 │
├─────────────────────────────────────────────┤
│                                             │
│ 分类:  ● 原料  ○ 设备  ○ 动作               │
│                                             │
│ 名称:  [Milk_________________________]      │
│                                             │
│ 推荐代码 (点击选择):                         │
│ ┌────┐ ┌────┐ ┌────┐                       │
│ │ MK │ │ M  │ │ mi │                       │
│ └────┘ └────┘ └────┘                       │
│                                             │
│ 代码:  [M_____________________________]     │
│        用于打印在杯贴上的简短代码            │
│                                             │
│                    [取消]  [保存]           │
└─────────────────────────────────────────────┘
```

### 设备步骤类型

```
┌─────────────────────────────────────────────┐
│ 创建步骤类型                                 │
├─────────────────────────────────────────────┤
│                                             │
│ 分类:  ○ 原料  ● 设备  ○ 动作               │
│                                             │
│ 名称:  [Blender_______________________]     │
│                                             │
│ 推荐代码 (点击选择):                         │
│ ┌──────┐                                    │
│ │ BLND │                                    │
│ └──────┘                                    │
│                                             │
│ 常用设备符号 (点击选择):                     │
│ ┌────┐ ┌────┐ ┌────┐ ┌────┐               │
│ │ [] │ │ () │ │ {} │ │ <> │               │
│ └────┘ └────┘ └────┘ └────┘               │
│ 提示: 设备符号会包裹内容，如 [M200]         │
│                                             │
│ 代码:  [[]____________________________]     │
│                                             │
│                    [取消]  [保存]           │
└─────────────────────────────────────────────┘
```

---

## 🔧 技术实现

### API调用

```typescript
// src/services/recipe/recipeService.ts

export const getCodeSuggestions = async (
  request: CodeSuggestionRequest
): Promise<CodeSuggestionResponse> => {
  const response = await http.post<ApiResponse<CodeSuggestionResponse>>(
    '/step-types/suggest',
    request
  )
  return response.data
}
```

### 组件实现

```typescript
// src/pages/RecipeGuide/StepTypeFormModalSimple.tsx

const handleNameChange = (e: React.ChangeEvent<HTMLInputElement>) => {
  const name = e.target.value.trim()
  
  // 防抖: 500ms后才发送请求
  setLoadingSuggestions(true)
  const timer = setTimeout(async () => {
    try {
      const result = await getCodeSuggestions({ name, category })
      setSuggestions(result.suggestions)
    } catch (error) {
      message.warning('获取代码建议失败')
    } finally {
      setLoadingSuggestions(false)
    }
  }, 500)
  
  setDebounceTimer(timer)
}
```

---

## 📊 支持的生成规则

### 1. 拼音首字母 (pinyin)
```
牛奶 → nn
茶叶 → cy
糖浆 → tt
```

### 2. 英文音节缩写 (english)
```
Milk → MK (去除元音 i)
Coffee → CF (去除元音 o, e, e)
Water → WTR (去除元音 a, e)
Blender → BLND (去除元音 e, e)
```

### 3. 常用缩写 (english_common)
```
Milk → M
Tea → T
Coffee → C
Sugar → S
```

### 4. 前缀 (prefix)
```
Milk → mi
Coffee → co
```

### 5. 设备符号 (symbol)
```
搅拌机 → []
加热器 → ()
烘焙机 → {}
冷藏柜 → <>
```

---

## 💡 最佳实践

### 1. 选择简短代码
- ✅ 推荐: `M`, `T`, `CF`
- ❌ 避免: `MILK`, `TEA123`

### 2. 保持一致性
- 同类型使用相同规则
- 例如: 所有原料用英文首字母

### 3. 设备使用符号
- 搅拌类设备: `[]`
- 加热类设备: `()`
- 冷藏类设备: `<>`

### 4. 避免冲突
- 系统会自动检查已存在的代码
- 如果冲突，会添加数字后缀（如 `M1`, `M2`）

---

## 🎯 优势总结

### ✅ 提高效率
- 自动生成建议，无需手动思考
- 点击即可选择，快速创建

### ✅ 智能识别
- 自动识别中文/英文
- 根据分类提供不同建议

### ✅ 避免错误
- 自动检查代码冲突
- 提供多个备选方案

### ✅ 用户友好
- 清晰的说明文字
- 直观的点击选择
- 支持自定义输入

---

## 🚀 现在就试试吧！

1. 打开配方管理页面
2. 切换到"步骤类型管理" Tab
3. 点击"添加步骤类型"
4. 输入名称，查看智能建议
5. 点击选择或手动输入
6. 保存完成！

---

**功能状态**: ✅ 已完整实现  
**测试状态**: 待测试  
**文档状态**: 已完成
