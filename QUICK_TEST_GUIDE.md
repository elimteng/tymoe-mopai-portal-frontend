# 🚀 快速测试指南 - 设备步骤包含功能

## 📋 问题
设备步骤无法选择包含其他步骤

## ✅ 修复内容
自动为设备类型（`category === 'equipment'`）的步骤添加容器属性

## 🧪 快速测试步骤

### 步骤 1: 刷新页面
```bash
# 确保开发服务器正在运行
npm run dev  # 或 pnpm dev
```

打开浏览器并**刷新页面**以加载最新代码。

### 步骤 2: 查看控制台日志

打开浏览器**开发者工具**（F12），切换到 **Console** 标签。

进入"制作指引"页面，点击某个商品的"创建配方"按钮。

**预期看到的日志**:
```
🔧 加载的步骤类型: [...]
⚙️ 自动设置 Blender 为容器步骤
⚙️ 自动设置 Mixer 为容器步骤
✅ 处理后的步骤类型: [...]
```

✅ 如果看到 `⚙️ 自动设置` 日志，说明自动处理逻辑生效了！

### 步骤 3: 测试创建配方

#### 3.1 添加第一个步骤（普通步骤）
```
1. 点击 "添加步骤"
2. 选择步骤类型: Milk (mk)
3. 输入 Instruction: 200
4. 应该看到代码: mk200
```

#### 3.2 添加第二个步骤（设备步骤）
```
1. 点击 "添加步骤"
2. 选择步骤类型: Blender ([])  <- 或任何设备类型
3. 应该立即看到:
   ┌─────────────────────────────────────┐
   │ ⚠️ 设备步骤 - 可以包含其他步骤      │
   │                                     │
   │ 选择要包含的步骤（可选）:            │
   │                                     │
   │ ☐ 步骤1: [mk] Milk  mk200          │
   │                                     │
   │ ℹ️ 未选择包含的步骤，将只打印设备代码 │
   └─────────────────────────────────────┘
```

✅ **如果看到这个黄色Alert框，说明修复成功！**

#### 3.3 勾选包含步骤
```
1. 勾选 "☑ 步骤1: Milk mk200"
2. 应该看到提示变为:
   ✅ 已选择 1 个步骤，它们将被包裹在 [...] 中
3. 输入 Instruction: 2
4. 应该看到代码: [mk200]2
```

#### 3.4 查看最终效果
```
步骤1: mk200 (灰色，显示"已被包含")
步骤2: ⚙️设备步骤 [mk200]2

Recipe打印代码: [mk200]2
```

✅ 如果代码显示正确，说明功能完全正常！

---

## 🎯 测试检查表

### 基础检查
- [ ] 页面刷新后无错误
- [ ] 控制台看到 "🔧 加载的步骤类型" 日志
- [ ] 控制台看到 "⚙️ 自动设置" 日志（如果有设备类型）
- [ ] 控制台看到 "✅ 处理后的步骤类型" 日志

### UI检查
- [ ] 设备步骤显示 **⚙️设备步骤** 橙色标签
- [ ] 设备步骤显示黄色Alert框
- [ ] Alert框标题：**"设备步骤 - 可以包含其他步骤"**
- [ ] 显示 **"选择要包含的步骤（可选）"** 文字
- [ ] 可以看到其他步骤的复选框

### 功能检查
- [ ] 可以勾选其他步骤
- [ ] 勾选后提示变为绿色成功信息
- [ ] 被包含的步骤变灰（虚线边框）
- [ ] 被包含的步骤显示"已被包含"标签
- [ ] 代码正确显示（如：`[mk200]2`）
- [ ] 最终Recipe打印代码正确

### 边界情况检查
- [ ] 只有设备步骤时显示"暂无其他步骤可包含"
- [ ] 取消勾选后提示变回蓝色信息
- [ ] 删除被包含的步骤后设备步骤更新
- [ ] 多个设备步骤可以独立包含不同步骤

---

## 🐛 如果还是不显示？

### 检查1: 确认步骤类型数据
在控制台输入：
```javascript
// 查看处理后的步骤类型
console.table(stepTypes)
```

查看 `isContainer` 列，设备类型应该是 `true`。

### 检查2: 确认React组件状态
在 `RecipeStepEditor.tsx` 中添加临时日志：
```tsx
console.log('当前步骤:', step)
console.log('步骤类型:', stepType)
console.log('是否容器:', stepType?.isContainer)
```

### 检查3: 清除缓存
```bash
# 清除浏览器缓存
Ctrl + Shift + Delete (Windows)
Cmd + Shift + Delete (Mac)

# 或硬刷新
Ctrl + F5 (Windows)
Cmd + Shift + R (Mac)
```

### 检查4: 重启开发服务器
```bash
# 停止服务器 (Ctrl + C)
# 重新启动
npm run dev
```

---

## 📸 预期效果截图描述

### 普通步骤
```
┌────────────────────────────────┐
│ 步骤 1  mk200         [↑][↓][×]│
├────────────────────────────────┤
│ 步骤类型: Milk (mk)            │
│ Instruction: 200               │
└────────────────────────────────┘
```

### 设备步骤（关键！）
```
┌──────────────────────────────────────────┐
│ 步骤 2  ⚙️设备步骤  blender2  [↑][↓][×] │ <- 橙色标签
├──────────────────────────────────────────┤
│ 步骤类型: Blender ([])                   │
│ Instruction: 2                           │
│                                          │
│ ╔══════════════════════════════════════╗ │
│ ║ ⚠️ 设备步骤 - 可以包含其他步骤       ║ │ <- 黄色Alert
│ ║                                      ║ │
│ ║ 选择要包含的步骤（可选）:             ║ │
│ ║                                      ║ │
│ ║ ☐ 步骤1: [mk] Milk  mk200           ║ │
│ ║                                      ║ │
│ ║ ℹ️ 未选择包含的步骤...                ║ │
│ ╚══════════════════════════════════════╝ │
└──────────────────────────────────────────┘
```

**✅ 如果看到黄色Alert框，说明修复成功！**

---

## 💡 提示

1. **确保刷新页面**：修改后必须刷新浏览器
2. **查看控制台**：所有调试信息都在控制台
3. **设备步骤类型**：只有 `category === 'equipment'` 的步骤才会显示包含选项
4. **步骤顺序**：先添加普通步骤，再添加设备步骤，才能看到包含选项

---

## ✅ 成功标志

看到以下内容说明修复成功：

1. ✅ 控制台有 `⚙️ 自动设置` 日志
2. ✅ 设备步骤有 **⚙️设备步骤** 标签
3. ✅ 显示黄色Alert框
4. ✅ 可以勾选其他步骤
5. ✅ 代码正确生成（如：`[mk200]2`）

---

**测试愉快！** 🎉

如果遇到问题，请查看：
- `EQUIPMENT_STEP_FIX.md` - 详细修复说明
- `EQUIPMENT_STEP_UI_ENHANCEMENT.md` - UI增强说明
- `RECIPE_PRINT_CODE_COMPLETE.md` - 完整功能说明














