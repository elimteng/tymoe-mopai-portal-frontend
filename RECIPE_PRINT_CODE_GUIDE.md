# é…æ–¹æ‰“å°ä»£ç ç³»ç»Ÿ - å®Œæ•´æŒ‡å—

## ğŸ“‹ æ¦‚è¿°

æ–°çš„é…æ–¹æ‰“å°ä»£ç ç³»ç»Ÿå…è®¸é€šè¿‡æ­¥éª¤ç¼–è¾‘å™¨è‡ªåŠ¨ç”Ÿæˆæ‰“å°ä»£ç ï¼Œæ”¯æŒè®¾å¤‡æ­¥éª¤åŒ…å«å…¶ä»–æ­¥éª¤ã€‚

## ğŸ¯ æ ¸å¿ƒæ¦‚å¿µ

### 1. æ­¥éª¤ç±»å‹ï¼ˆStepTypeï¼‰

æ¯ä¸ªæ­¥éª¤ç±»å‹åŒ…å«ï¼š
- **code**: æ‰“å°ä»£ç ï¼ˆå¦‚ï¼š`mk` è¡¨ç¤º milkï¼‰
- **name**: æ˜¾ç¤ºåç§°ï¼ˆå¦‚ï¼šç‰›å¥¶ï¼‰
- **category**: ç±»åˆ«ï¼ˆingredient/equipment/actionï¼‰
- **isContainer**: æ˜¯å¦æ˜¯å®¹å™¨æ­¥éª¤ï¼ˆè®¾å¤‡æ­¥éª¤ï¼‰
- **containerPrefix/Suffix**: å®¹å™¨å‰åç¼€ï¼ˆå¦‚ï¼š`[` å’Œ `]`ï¼‰

### 2. é…æ–¹æ­¥éª¤ï¼ˆRecipeStepï¼‰

æ¯ä¸ªæ­¥éª¤åŒ…å«ï¼š
- **stepTypeId**: æ­¥éª¤ç±»å‹ID
- **instruction**: ç”¨æˆ·è¾“å…¥çš„æŒ‡ä»¤ï¼ˆæ•°é‡/æ“ä½œ/å¿«æ·é”®ç­‰ï¼‰
- **containedSteps**: åŒ…å«çš„å…¶ä»–æ­¥éª¤ç´¢å¼•ï¼ˆè®¾å¤‡æ­¥éª¤ä¸“ç”¨ï¼‰
- **generatedPrintCode**: è‡ªåŠ¨ç”Ÿæˆçš„æ‰“å°ä»£ç 

### 3. æ‰“å°ä»£ç ç”Ÿæˆè§„åˆ™

#### æ™®é€šæ­¥éª¤
```
æ‰“å°ä»£ç  = æ­¥éª¤ä»£ç  + instruction
```

**ç¤ºä¾‹**:
- Milk (mk) + 200 = `mk200`
- Sugar (sg) + 50 = `sg50`
- Heat (ht) + (ç©º) = `ht`

#### è®¾å¤‡æ­¥éª¤ï¼ˆå®¹å™¨æ­¥éª¤ï¼‰
```
æ‰“å°ä»£ç  = [åŒ…å«çš„æ­¥éª¤ä»£ç ]è®¾å¤‡instruction
```

**ç¤ºä¾‹**:
- æ…æ‹Œæœº ([]) åŒ…å« mk200ï¼ŒæŒ‰2é”® = `[mk200]2`
- æ…æ‹Œæœº ([]) åŒ…å« mk200 + sg50ï¼ŒæŒ‰3é”® = `[mk200sg50]3`

#### å®Œæ•´é…æ–¹
```
recipeæ‰“å°ä»£ç  = æ‰€æœ‰æœªè¢«åŒ…å«çš„æ­¥éª¤ä»£ç è¿æ¥
```

**è¢«åŒ…å«çš„æ­¥éª¤ä¸ä¼šå•ç‹¬æ‰“å°**

---

## ğŸ“ ä½¿ç”¨ç¤ºä¾‹

### ç¤ºä¾‹1ï¼šç®€å•å¥¶èŒ¶

**æ­¥éª¤è®¾ç½®**:
1. æ­¥éª¤1: Milk (mk) + instruction: "200"
2. æ­¥éª¤2: Tea (tea) + instruction: "100"
3. æ­¥éª¤3: Sugar (sg) + instruction: "50"

**ç”Ÿæˆçš„æ‰“å°ä»£ç **:
- æ­¥éª¤1: `mk200`
- æ­¥éª¤2: `tea100`
- æ­¥éª¤3: `sg50`
- **Recipeæ‰“å°ä»£ç **: `mk200tea100sg50`

---

### ç¤ºä¾‹2ï¼šå¸¦æ…æ‹Œæœºçš„å¥¶èŒ¶

**æ­¥éª¤è®¾ç½®**:
1. æ­¥éª¤1: Milk (mk) + instruction: "200"
2. æ­¥éª¤2: Tea (tea) + instruction: "100"
3. æ­¥éª¤3: Blender ([]) + instruction: "2" + åŒ…å«: [æ­¥éª¤1, æ­¥éª¤2]
4. æ­¥éª¤4: Sugar (sg) + instruction: "50"

**ç”Ÿæˆçš„æ‰“å°ä»£ç **:
- æ­¥éª¤1: `mk200` (è¢«åŒ…å«ï¼Œä¸å•ç‹¬æ‰“å°)
- æ­¥éª¤2: `tea100` (è¢«åŒ…å«ï¼Œä¸å•ç‹¬æ‰“å°)
- æ­¥éª¤3: `[mk200tea100]2` âœ…
- æ­¥éª¤4: `sg50` âœ…
- **Recipeæ‰“å°ä»£ç **: `[mk200tea100]2sg50`

---

### ç¤ºä¾‹3ï¼šå¤æ‚åœºæ™¯ - å¤šå±‚åŒ…å«

**æ­¥éª¤è®¾ç½®**:
1. æ­¥éª¤1: Water (wt) + instruction: "300"
2. æ­¥éª¤2: Coffee Powder (cf) + instruction: "20g"
3. æ­¥éª¤3: Coffee Machine (<>) + instruction: "hot" + åŒ…å«: [æ­¥éª¤1, æ­¥éª¤2]
4. æ­¥éª¤4: Milk (mk) + instruction: "200"
5. æ­¥éª¤5: Blender ([]) + instruction: "3" + åŒ…å«: [æ­¥éª¤3, æ­¥éª¤4]

**ç”Ÿæˆçš„æ‰“å°ä»£ç **:
- æ­¥éª¤1: `wt300` (è¢«æ­¥éª¤3åŒ…å«)
- æ­¥éª¤2: `cf20g` (è¢«æ­¥éª¤3åŒ…å«)
- æ­¥éª¤3: `<wt300cf20g>hot` (è¢«æ­¥éª¤5åŒ…å«)
- æ­¥éª¤4: `mk200` (è¢«æ­¥éª¤5åŒ…å«)
- æ­¥éª¤5: `[<wt300cf20g>hotmk200]3` âœ…
- **Recipeæ‰“å°ä»£ç **: `[<wt300cf20g>hotmk200]3`

---

## ğŸ› ï¸ å‰ç«¯å®ç°

### ç»„ä»¶ç»“æ„

```
RecipeFormWithSteps (è¡¨å•)
  â””â”€â”€ RecipeStepEditor (æ­¥éª¤ç¼–è¾‘å™¨)
        â”œâ”€â”€ æ­¥éª¤åˆ—è¡¨
        â”œâ”€â”€ å®æ—¶é¢„è§ˆ
        â””â”€â”€ æœ€ç»ˆæ‰“å°ä»£ç æ˜¾ç¤º
```

### æ ¸å¿ƒæ–‡ä»¶

1. **ç±»å‹å®šä¹‰**: `src/services/recipe/types.ts`
   - RecipeStep: åŒ…å« instruction å’Œ containedSteps
   - StepType: åŒ…å« isContainer å’Œå®¹å™¨å‰åç¼€

2. **æ‰“å°ä»£ç ç”Ÿæˆå™¨**: `src/utils/printCodeGenerator.ts`
   - `generateStepPrintCode()`: ç”Ÿæˆå•ä¸ªæ­¥éª¤ä»£ç 
   - `generateRecipePrintCode()`: ç”Ÿæˆå®Œæ•´é…æ–¹ä»£ç 
   - `generateStepPreviews()`: å®æ—¶é¢„è§ˆ

3. **æ­¥éª¤ç¼–è¾‘å™¨**: `src/pages/RecipeGuide/RecipeStepEditor.tsx`
   - æ·»åŠ /åˆ é™¤/æ’åºæ­¥éª¤
   - é€‰æ‹©æ­¥éª¤ç±»å‹
   - è¾“å…¥ instruction
   - è®¾å¤‡æ­¥éª¤é€‰æ‹©åŒ…å«çš„æ­¥éª¤
   - å®æ—¶æ˜¾ç¤ºç”Ÿæˆçš„æ‰“å°ä»£ç 

4. **é…æ–¹è¡¨å•**: `src/pages/RecipeGuide/RecipeFormWithSteps.tsx`
   - æ•´åˆæ­¥éª¤ç¼–è¾‘å™¨
   - æäº¤åˆ°åç«¯

---

## ğŸ”§ åç«¯è¦æ±‚

### æ•°æ®åº“å­—æ®µ

**recipes è¡¨**:
- `print_code`: å•†å“æ‰“å°ä»£ç ï¼ˆå¦‚ï¼šLICEï¼‰
- `recipe_print_code`: å®Œæ•´åˆ¶ä½œæ‰“å°ä»£ç ï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼‰

**recipe_steps è¡¨**:
- `step_type_id`: æ­¥éª¤ç±»å‹ID
- `instruction`: ç”¨æˆ·è¾“å…¥çš„instruction
- `contained_steps`: JSONæ•°ç»„ï¼ŒåŒ…å«çš„æ­¥éª¤ID
- `generated_print_code`: ç”Ÿæˆçš„æ‰“å°ä»£ç 
- `display_order`: æ˜¾ç¤ºé¡ºåº

**step_types è¡¨**:
- `code`: æ‰“å°ä»£ç 
- `is_container`: æ˜¯å¦æ˜¯å®¹å™¨æ­¥éª¤
- `container_prefix`: å®¹å™¨å‰ç¼€ï¼ˆé»˜è®¤ï¼š`[`ï¼‰
- `container_suffix`: å®¹å™¨åç¼€ï¼ˆé»˜è®¤ï¼š`]`ï¼‰

### API æ›´æ–°

#### åˆ›å»º/æ›´æ–°é…æ–¹
```typescript
POST /recipes
{
  "itemId": "item-001",
  "printCode": "LICE",
  "conditions": [...],
  "steps": [
    {
      "stepTypeId": "type-001",
      "displayOrder": 1,
      "instruction": "200",
      "containedSteps": []  // æ­¥éª¤ç´¢å¼•æ•°ç»„
    },
    {
      "stepTypeId": "type-002",
      "displayOrder": 2,
      "instruction": "2",
      "containedSteps": [0]  // åŒ…å«æ­¥éª¤0
    }
  ]
}
```

åç«¯éœ€è¦ï¼š
1. åŠ è½½æ‰€æœ‰æ­¥éª¤ç±»å‹
2. æ ¹æ®æ­¥éª¤é¡ºåºå’ŒåŒ…å«å…³ç³»ç”Ÿæˆæ‰“å°ä»£ç 
3. ä¿å­˜ `recipe_print_code` åˆ°æ•°æ®åº“

---

## ğŸ“Š UI/UX è®¾è®¡

### æ­¥éª¤å¡ç‰‡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ­¥éª¤ 1                    mk200 [â†‘][â†“][Ã—]â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æ­¥éª¤ç±»å‹: [Milk (mk)            â–¼]     â”‚
â”‚ Instruction: [200_____________]        â”‚
â”‚                                        â”‚
â”‚ â„¹ï¸ ä»£ç : mk + 200 = mk200              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ­¥éª¤ 2  ğŸ”§è®¾å¤‡  [mk200]2  [â†‘][â†“][Ã—]    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æ­¥éª¤ç±»å‹: [Blender ([])         â–¼]     â”‚
â”‚ Instruction: [2________________]       â”‚
â”‚                                        â”‚
â”‚ åŒ…å«çš„æ­¥éª¤:                             â”‚
â”‚ â˜‘ æ­¥éª¤1: Milk mk200                    â”‚
â”‚                                        â”‚
â”‚ â„¹ï¸ ä»£ç : [mk200]2                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æœ€ç»ˆé¢„è§ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â„¹ï¸ Recipeæ‰“å°ä»£ç                        â”‚
â”‚                                        â”‚
â”‚ [mk200]2                               â”‚
â”‚                                        â”‚
â”‚ æ­¤ä»£ç å°†ä¿å­˜åˆ°æ•°æ®åº“ï¼Œç”¨äºè®¢å•æ‰“å°      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## âœ… å®ç°æ£€æŸ¥æ¸…å•

### å‰ç«¯
- [x] æ›´æ–°ç±»å‹å®šä¹‰ï¼ˆinstruction, containedSteps, isContainerç­‰ï¼‰
- [x] åˆ›å»ºæ‰“å°ä»£ç ç”Ÿæˆå™¨å·¥å…·
- [x] åˆ›å»ºæ­¥éª¤ç¼–è¾‘å™¨ç»„ä»¶
- [x] åˆ›å»ºé…æ–¹è¡¨å•ç»„ä»¶
- [ ] é›†æˆåˆ°ç°æœ‰çš„é…æ–¹ç®¡ç†é¡µé¢
- [ ] æ·»åŠ i18nç¿»è¯‘

### åç«¯
- [ ] æ›´æ–°æ•°æ®åº“schema
  - [ ] æ·»åŠ  recipe_print_code å­—æ®µ
  - [ ] æ·»åŠ  instruction å­—æ®µ
  - [ ] æ·»åŠ  contained_steps JSONå­—æ®µ
  - [ ] æ·»åŠ  is_container, container_prefix, container_suffix å­—æ®µ
- [ ] å®ç°æ‰“å°ä»£ç ç”Ÿæˆé€»è¾‘
- [ ] æ›´æ–° API å“åº”åŒ…å«æ–°å­—æ®µ
- [ ] æ·»åŠ æ‰“å°ä»£ç éªŒè¯

---

## ğŸ¯ ä½¿ç”¨æµç¨‹

### åˆ›å»ºé…æ–¹

1. ç”¨æˆ·é€‰æ‹©å•†å“å’Œä¿®é¥°ç¬¦ç»„åˆ
2. è¾“å…¥å•†å“æ‰“å°ä»£ç ï¼ˆå¦‚ï¼šLICEï¼‰
3. **æ·»åŠ åˆ¶ä½œæ­¥éª¤**ï¼š
   - ç‚¹å‡»"æ·»åŠ æ­¥éª¤"
   - é€‰æ‹©æ­¥éª¤ç±»å‹ï¼ˆmilk, tea, blenderç­‰ï¼‰
   - è¾“å…¥instructionï¼ˆ200, 2é”®ç­‰ï¼‰
   - å¦‚æœæ˜¯è®¾å¤‡æ­¥éª¤ï¼Œå‹¾é€‰è¦åŒ…å«çš„æ­¥éª¤
4. **å®æ—¶é¢„è§ˆ**ï¼š
   - æ¯ä¸ªæ­¥éª¤æ˜¾ç¤ºç”Ÿæˆçš„æ‰“å°ä»£ç 
   - é¡¶éƒ¨æ˜¾ç¤ºæœ€ç»ˆçš„recipeæ‰“å°ä»£ç 
   - è¢«åŒ…å«çš„æ­¥éª¤æ˜¾ç¤º"å·²è¢«åŒ…å«"æ ‡è®°
5. æäº¤ä¿å­˜

### æŸ¥çœ‹/ç¼–è¾‘é…æ–¹

1. ä»åˆ—è¡¨é€‰æ‹©é…æ–¹
2. æŸ¥çœ‹æ‰€æœ‰æ­¥éª¤å’Œæ‰“å°ä»£ç 
3. ä¿®æ”¹instructionæˆ–è°ƒæ•´åŒ…å«å…³ç³»
4. å®æ—¶æ›´æ–°æ‰“å°ä»£ç é¢„è§ˆ
5. ä¿å­˜æ›´æ–°

---

## ğŸš€ æ‰©å±•åŠŸèƒ½

### æœªæ¥å¯èƒ½çš„å¢å¼º

1. **æ­¥éª¤æ¨¡æ¿**ï¼šå¸¸ç”¨æ­¥éª¤ç»„åˆä¿å­˜ä¸ºæ¨¡æ¿
2. **æ‰“å°ä»£ç éªŒè¯**ï¼šæ£€æŸ¥ä»£ç æ ¼å¼å’Œé•¿åº¦
3. **æ­¥éª¤å¤åˆ¶**ï¼šå¿«é€Ÿå¤åˆ¶ç°æœ‰æ­¥éª¤
4. **æ‰¹é‡ç¼–è¾‘**ï¼šåŒæ—¶ä¿®æ”¹å¤šä¸ªé…æ–¹çš„æ­¥éª¤
5. **ä»£ç æ˜ å°„è¡¨**ï¼šç»´æŠ¤æ‰“å°ä»£ç åˆ°è®¾å¤‡å‘½ä»¤çš„æ˜ å°„
6. **å¯è§†åŒ–æµç¨‹å›¾**ï¼šå›¾å½¢åŒ–æ˜¾ç¤ºæ­¥éª¤æµç¨‹å’ŒåŒ…å«å…³ç³»

---

**ç‰ˆæœ¬**: 1.0.0  
**æœ€åæ›´æ–°**: 2025-10-31  
**ä½œè€…**: AI Assistant














