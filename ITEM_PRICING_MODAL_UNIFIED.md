# 商品定价模态框统一视图优化

## 📅 更新时间
2025-11-06

## 🎯 优化目标

将商品基础价格和自定义选项定价整合到一个统一的模态框中，提供更直观、流畅的用户体验。

---

## ✨ 主要改进

### 1. 统一视图设计

**优化前：**
- 使用Tab分页，商品基础价格和自定义选项定价分开在两个Tab
- 用户需要切换Tab才能看到不同部分
- 信息割裂，不利于整体把握

**优化后：**
- 所有信息在一个页面中纵向排列
- 上半部分：商品基础价格卡片
- 下半部分：自定义选项定价卡片
- 无需切换，一目了然

### 2. 卡片式布局

使用Ant Design的Card组件创建清晰的信息层次：

```tsx
<Modal width={1200}>
  {/* 商品基础价格区域 */}
  <Card title="商品基础价格" extra={修改标记}>
    <统计信息卡片>
      - 原价
      - 渠道价格输入框
      - 价格变化
    </统计信息卡片>
  </Card>

  <Divider />

  {/* 自定义选项定价区域 */}
  <Card title="自定义选项定价" extra={刷新按钮}>
    <统计信息>
      - 总数
      - 已设置渠道价数量
      - 使用默认价数量
      - 待保存数量
    </统计信息>
    <价格表格 />
  </Card>
</Modal>
```

### 3. 视觉增强

#### 商品基础价格区域
- **原价卡片**：灰色背景，突出显示默认价格
- **渠道价格输入**：大尺寸输入框，易于操作
- **价格变化卡片**：
  - 涨价：绿色背景 + 绿色文字
  - 降价：橙色背景 + 橙色文字
  - 动态显示差价

#### 自定义选项定价区域
- **统计信息行**：4个统计卡片并排显示
  - 总数
  - 渠道定价数（绿色）
  - 默认价格数（灰色）
  - 待保存数（橙色）
- **价格表格**：
  - 紧凑型表格，最大高度350px，自动滚动
  - 修改行高亮显示（橙色背景）
  - 内联编辑支持

### 4. 交互优化

#### Footer增强
```tsx
<Footer>
  <Left>
    {hasChanges && <警告提示：有未保存的更改>}
  </Left>
  <Right>
    <取消按钮>
    <保存按钮 (显示修改数量)>
  </Right>
</Footer>
```

#### 实时反馈
- 修改商品价格 → 立即显示"已修改"标签
- 修改选项价格 → 表格行高亮
- Footer显示总修改数：`(商品价格修改数 + 选项修改数)`

### 5. 统计信息可视化

**商品基础价格统计：**
- 3列布局：原价 | 渠道价 | 价格变化
- 使用Statistic组件，数字大而清晰
- 价格变化带颜色指示

**自定义选项统计：**
- 4列布局：总数 | 已设渠道价 | 默认价 | 待保存
- 数字大小：20px，一目了然
- 颜色区分：绿色（渠道价）、灰色（默认）、橙色（待保存）

---

## 🎨 UI布局

```
┌─────────────────────────────────────────────────────┐
│ 💰 商品定价详情 - 黑糖珍珠奶茶  [渠道: Office1]     │
├─────────────────────────────────────────────────────┤
│                                                       │
│ ┌─ 💰 商品基础价格 ──────────────────── [已修改] ─┐ │
│ │ ℹ️  设置该商品在此渠道的基础价格，留空则使用默认  │ │
│ │                                                   │ │
│ │ ┌────────┐  ┌────────────┐  ┌──────────────┐   │ │
│ │ │ 原价    │  │ 渠道价格    │  │  价格变化     │   │ │
│ │ │ ¥7.99   │  │ [输入框]   │  │  +¥2.00 ⬆    │   │ │
│ │ └────────┘  │ ¥9.99      │  └──────────────┘   │ │
│ │             └────────────┘                      │ │
│ └─────────────────────────────────────────────────┘ │
│                                                       │
│ ─────────────────────────────────────────────────── │
│                                                       │
│ ┌─ ℹ️  自定义选项定价 (12) ──── [已修改: 3] [刷新] ─┐ │
│ │                                                   │ │
│ │ 统计: 总数12 | 渠道价3 | 默认价9 | 待保存3        │ │
│ │                                                   │ │
│ │ ┌─表格──────────────────────────────────────┐   │ │
│ │ │ 选项组 │ 选项名 │ 默认价 │ 渠道价 │ 最终价 │操作││ │
│ │ │ 杯型   │ 大杯   │ ¥2.00 │ [输入] │ ¥3.00 │编辑││ │
│ │ │ 杯型   │ 中杯   │ ¥0.00 │ 未设置 │ ¥0.00 │编辑││ │
│ │ │ 温度   │ 冰     │ ¥0.00 │ 未设置 │ ¥0.00 │编辑││ │
│ │ │ ...                                           │ │
│ │ └───────────────────────────────────────────┘   │ │
│ │                                                   │ │
│ │ ℹ️  提示：价格优先级 渠道价 > 商品价 > 默认价     │ │
│ └─────────────────────────────────────────────────┘ │
│                                                       │
├─────────────────────────────────────────────────────┤
│ ⚠️  有未保存的更改          [取消]  [保存 (4)]      │
└─────────────────────────────────────────────────────┘
```

---

## 📝 技术实现

### 1. 移除Tab组件

**Before:**
```tsx
<Tabs>
  <TabPane tab="商品基础价格" key="base">
    {...}
  </TabPane>
  <TabPane tab="自定义选项定价" key="options">
    {...}
  </TabPane>
</Tabs>
```

**After:**
```tsx
<Space direction="vertical" size="large">
  <Card title="商品基础价格">
    {...}
  </Card>
  
  <Divider />
  
  <Card title="自定义选项定价">
    {...}
  </Card>
</Space>
```

### 2. 增强的统计信息

```typescript
const getStatistics = () => {
  const total = customOptionPrices.length
  const withSourcePrice = customOptionPrices.filter(p => p.priceSource === 'source').length
  const modified = customOptionPrices.filter(p => p.modified).length
  
  return { 
    total, 
    withSourcePrice, 
    withDefaultPrice: total - withSourcePrice,
    modified 
  }
}
```

### 3. 模态框宽度调整

```tsx
<Modal
  width={1200}  // 从1000增加到1200，容纳更多信息
  style={{ top: 20 }}  // 距顶部20px，更好利用空间
>
```

### 4. Footer增强

```tsx
footer={
  <div style={{ display: 'flex', justifyContent: 'space-between' }}>
    <Space>
      {hasChanges && (
        <Text type="warning">
          <InfoCircleOutlined /> 有未保存的更改
        </Text>
      )}
    </Space>
    <Space>
      <Button onClick={onClose}>取消</Button>
      <Button 
        type="primary" 
        disabled={!hasChanges}
        onClick={handleSave}
      >
        保存 {hasChanges && `(${changeCount})`}
      </Button>
    </Space>
  </div>
}
```

---

## 🎯 用户体验提升

### 1. 信息密度优化
- **Before**: 需要切换Tab，每次只能看到一部分信息
- **After**: 所有信息纵向排列，滚动浏览，一览全局

### 2. 操作流程简化
- **Before**: 
  1. 打开模态框
  2. 在"基础价格"Tab修改价格
  3. 切换到"自定义选项"Tab
  4. 修改选项价格
  5. 保存
  
- **After**:
  1. 打开模态框（所有信息可见）
  2. 修改基础价格
  3. 向下滚动
  4. 修改选项价格
  5. 保存

### 3. 视觉反馈增强
- 修改状态实时标记
- 价格变化用颜色区分
- 统计信息一目了然
- Footer警告提示未保存更改

### 4. 空间利用率提高
- 宽度从1000px → 1200px
- 表格高度固定350px，自动滚动
- 去除Tab切换按钮，节省空间
- 卡片式布局，信息层次清晰

---

## 📊 数据流

```typescript
// 数据加载流程
Modal Open
  ↓
加载商品基础价格
  ↓
加载商品修饰符组
  ↓
批量调用价格计算API
  ↓
构建价格数据表格
  ↓
显示完整信息

// 保存流程
用户修改
  ↓
本地标记修改状态 (modified: true)
  ↓
Footer显示修改数量
  ↓
用户点击保存
  ↓
并行保存：
  - 商品基础价格
  - 自定义选项价格
  ↓
重新加载数据
  ↓
重置修改状态
```

---

## 🚀 使用说明

### 打开模态框
```tsx
// 点击商品卡片
<Card onClick={() => {
  setSelectedItem({ item, setter, list })
  setPricingModalVisible(true)
}}>
  商品信息
</Card>
```

### 修改商品基础价格
1. 在"商品基础价格"卡片中找到"渠道价格"输入框
2. 输入新价格
3. 右侧自动显示价格变化
4. 卡片右上角显示"已修改"标签

### 修改自定义选项价格
1. 向下滚动到"自定义选项定价"卡片
2. 找到要修改的选项
3. 点击"编辑"按钮
4. 在表格中直接输入新价格
5. 点击确认图标保存（或取消图标取消）
6. 修改的行会高亮显示

### 保存所有修改
1. 检查Footer是否显示"有未保存的更改"
2. 查看保存按钮上的修改数量
3. 点击"保存"按钮
4. 等待保存成功提示
5. 模态框保持打开，数据自动刷新

---

## 🎨 样式优化

### 1. 价格变化颜色

```tsx
// 涨价
background: '#f6ffed'  // 淡绿色背景
borderColor: '#b7eb8f'  // 绿色边框
color: '#52c41a'        // 绿色文字

// 降价
background: '#fff2e8'   // 淡橙色背景
borderColor: '#ffbb96'  // 橙色边框
color: '#ff7a45'        // 橙色文字
```

### 2. 修改行高亮

```css
.row-modified {
  background-color: #fff7e6 !important;  /* 橙色背景 */
}

.row-modified:hover > td {
  background-color: #ffe7ba !important;  /* 深橙色悬停 */
}
```

### 3. 统计卡片字体

```tsx
<Statistic
  valueStyle={{ fontSize: 20 }}  // 数字更大
  valueStyle={{ color: '#52c41a' }}  // 带颜色
/>
```

---

## 📂 文件变更

### 修改的文件
1. ✅ `/src/pages/OrderConfig/ItemPricingModal.tsx`
   - 移除Tabs组件
   - 改用纵向Card布局
   - 增强统计信息显示
   - 优化Footer布局

2. ✅ `/src/i18n/locales/zh-CN.ts`
   - 新增：`unsavedChanges` - 有未保存的更改
   - 新增：`pendingSave` - 待保存

---

## ✅ 优化效果对比

| 维度 | 优化前 | 优化后 | 提升 |
|------|--------|--------|------|
| **信息可见性** | 需切换Tab | 一页显示全部 | ⭐⭐⭐⭐⭐ |
| **操作步骤** | 5步 | 3步 | ⭐⭐⭐⭐ |
| **视觉反馈** | 基础 | 丰富（颜色+标签+统计） | ⭐⭐⭐⭐⭐ |
| **空间利用** | 一般 | 优秀（卡片+滚动） | ⭐⭐⭐⭐ |
| **用户体验** | 良好 | 优秀 | ⭐⭐⭐⭐⭐ |

---

## 🎉 总结

### 核心改进
1. **统一视图**：去除Tab，所有信息一页展示
2. **卡片布局**：清晰的信息层次和视觉边界
3. **视觉增强**：颜色、图标、统计数字
4. **交互优化**：实时反馈、内联编辑、批量保存

### 用户价值
- ✅ 减少操作步骤
- ✅ 提高信息可见性
- ✅ 增强视觉反馈
- ✅ 优化空间利用
- ✅ 提升整体体验

### 技术价值
- ✅ 代码结构清晰
- ✅ 组件复用性好
- ✅ 易于维护扩展
- ✅ 性能优化（批量API调用）

---

**最后更新**: 2025-11-06  
**优化者**: Claude AI Assistant  
**版本**: v2.0 - 统一视图版

