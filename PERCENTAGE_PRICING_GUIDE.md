# 百分比定价功能说明

## 功能概述
渠道定价支持三种模式，现已完整支持百分比定价方式：

### 三种定价模式

1. **原价模式 (none)**
   - 使用菜品/加料/套餐的原始价格
   - 无需设置任何参数

2. **固定价格模式 (price)**
   - 为该渠道设置固定的价格
   - 适用于需要统一价格的渠道

3. **百分比折扣模式 (percentage)** ✨ 新增功能
   - 基于原价的百分比调整
   - 支持双向编辑：
     - 输入百分比 → 自动计算最终价格
     - 输入最终价格 → 自动计算百分比
   - 百分比范围：-100% 到 +100%

## 百分比定价使用方式

### 输入方式 1: 直接输入百分比
1. 选择 "百分比折扣" 模式
2. 在百分比字段输入数值（如：-10）
3. 系统自动计算显示最终价格

**示例：**
- 原价：¥100
- 百分比：-10
- 最终价格：¥90

### 输入方式 2: 输入最终价格
1. 选择 "百分比折扣" 模式
2. 在最终价格字段输入目标价格（如：¥85）
3. 系统自动计算反推百分比

**示例：**
- 原价：¥100
- 最终价格：¥85
- 百分比：-15%

## 数据保存

### 保存的数据格式
百分比模式下，系统会保存以下信息：
- `strategy`: "percentage" - 标记为百分比模式
- `priceDiff`: 百分比数值（如：-10 表示 -10%）

### 验证规则
- 百分比范围检查：-100 到 100
- 最终价格下限：≥ 0
- 当百分比为 -100% 时，最终价格为 ¥0
- 当百分比为 +100% 时，最终价格为原价的 2 倍

## 前端计算逻辑

### 百分比 → 最终价格
```
最终价格 = 原价 × (1 + 百分比 / 100)
```

### 最终价格 → 百分比
```
百分比 = (最终价格 - 原价) / 原价 × 100
```

## 后端数据结构

API 请求格式：
```json
{
  "sourceCode": "meituan",
  "itemId": "item-001",
  "strategy": "percentage",
  "priceDiff": -10,
  "price": null  // 固定价格模式才需要
}
```

## UI 显示说明

### 百分比卡片显示
- **百分比折扣** 字段：输入百分比数值
- **最终价格** 字段：显示/编辑最终价格
- **价格对比** 显示：
  - 原价信息
  - 涨跌箭头和百分比
  - 颜色提示：↑ 绿色（涨价），↓ 红色（降价）

### 视觉反馈
- 修改后的卡片会显示橙色边框
- 已修改标签显示修改状态
- 实时计算和更新显示

## 注意事项

⚠️ **属性修改器将被忽略**
- 在百分比定价模式下，菜品属性的价格修改器不生效
- 最终价格以百分比定价规则计算

## 兼容性

- 与现有的固定价格模式完全兼容
- 与后端 `PriceStrategy.PERCENTAGE` 完全一致
- 支持与加料、套餐一同使用

